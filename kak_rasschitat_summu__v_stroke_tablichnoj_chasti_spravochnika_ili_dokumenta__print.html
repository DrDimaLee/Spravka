<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<base target="_blank" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link href="css/printed.css" media="all" rel="StyleSheet" type="text/css" />
		<link href="de_style.css" media="all" rel="StyleSheet" type="text/css" />
		<meta name="generator" content="www.DrExplain.com" />
				<title>1.2.1.5. &#x041A;&#x0430;&#x043A; &#x0440;&#x0430;&#x0441;&#x0441;&#x0447;&#x0438;&#x0442;&#x0430;&#x0442;&#x044C; &#x0441;&#x0443;&#x043C;&#x043C;&#x0443;&#x00A0; &#x0432; &#x0441;&#x0442;&#x0440;&#x043E;&#x043A;&#x0435; &#x0442;&#x0430;&#x0431;&#x043B;&#x0438;&#x0447;&#x043D;&#x043E;&#x0439; &#x0447;&#x0430;&#x0441;&#x0442;&#x0438; &#x0441;&#x043F;&#x0440;&#x0430;&#x0432;&#x043E;&#x0447;&#x043D;&#x0438;&#x043A;&#x0430; &#x0438;&#x043B;&#x0438; &#x0434;&#x043E;&#x043A;&#x0443;&#x043C;&#x0435;&#x043D;&#x0442;&#x0430;?</title>
	</head>
	<body>
		<table class="pagetable">
			<tr class="page" style="border-color: #ffffff;">
				<td class="page_area" style="border-color: #ffffff; width: 100%;"><div class="description_on_page"><div class="p" style="text-align: center; direction: ltr; margin-left: 0px; text-indent: 0px;"><div class="ic"><h1><strong>1.2.1.5. Как рассчитать сумму  в строке табличной части справочника или документа?</strong></h1></div></div>
<div class="p" style="text-align: right; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_8112703D22">09.12.2009</span></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_C3917CD988">В реальной работе прикладного решения часто возникает необходимость автоматизировать некоторые подсчеты согласно собственному алгоритму. Например, сделать так, чтобы сумма в строке табличной части документа автоматически вычислялась при изменении цены или количества в строке.</span></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_C3917CD988">Это небольшое вычисление производится в модуле формы в процедуре, выполняющейся на клиенте. Такой процедурой являются обработчики события <strong>ПриИзменении </strong>полей <strong>Цена </strong>и <strong>Количество </strong>табличной части документа.</span></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_C3917CD988">Итак, сначала нужно создать форму документа, чтобы в ней описать собственный алгоритм вычислений. Затем, открыв палитру свойств полей <strong>Цена </strong>и <strong>Количество </strong>табличной части документа, создать для них обработчики события <strong>ПриИзменении </strong>и внести в них следующий код:</span></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><a href="javascript:"><span class="de_96F0909776">Копировать в буфер обмена</span></a></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 10px; text-indent: 0px;"><table class="de_tbl_566 detbl" style="width: 100%; margin-left: 0; margin-right: auto;">
<col style="width: 100%;" class="de_col_1_566" />
<tr style="height: 0px;">
<td class="de_td_566" style = "padding: 2px; padding-bottom: 1px; border-left-style: none; border-left-width: 3px; border-left-color: #0000ff; border-right-style: none; border-right-width: 3px; border-right-color: #0000ff; border-top-style: none; border-top-width: 3px; border-top-color: #0000ff; border-bottom-style: none; border-bottom-width: 3px; border-bottom-color: #0000ff;  width: 100%; vertical-align: top; background-color: #f0f0f0;" colspan = "1" rowspan = "1" >
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_8A030B40E6">&amp;НаКлиенте</span><span class="de_EAEC673B3E">Процедура</span><span class="de_8A030B40E6"> МатериалыКоличествоПриИзменении</span><span class="de_EAEC673B3E">(</span><span class="de_8A030B40E6">Элемент</span><span class="de_EAEC673B3E">)</span><span class="de_8A030B40E6"> &#160; СтрокаТабличнойЧасти </span><span class="de_EAEC673B3E">=</span><span class="de_8A030B40E6"> Элементы</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Материалы</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">ТекущиеДанные</span><span class="de_EAEC673B3E">;</span><span class="de_8A030B40E6"> &#160; СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Сумма </span><span class="de_EAEC673B3E">=</span><span class="de_8A030B40E6"> СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Количество </span><span class="de_EAEC673B3E">*</span><span class="de_8A030B40E6"> СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Цена</span><span class="de_EAEC673B3E">;КонецПроцедуры</span><span class="de_8A030B40E6">&amp;НаКлиенте</span><span class="de_EAEC673B3E">Процедура</span><span class="de_8A030B40E6"> МатериалыЦенаПриИзменении</span><span class="de_EAEC673B3E">(</span><span class="de_8A030B40E6">Элемент</span><span class="de_EAEC673B3E">)</span><span class="de_8A030B40E6"> &#160; СтрокаТабличнойЧасти </span><span class="de_EAEC673B3E">=</span><span class="de_8A030B40E6"> Элементы</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Материалы</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">ТекущиеДанные</span><span class="de_EAEC673B3E">;</span><span class="de_8A030B40E6"> &#160; СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Сумма </span><span class="de_EAEC673B3E">=</span><span class="de_8A030B40E6"> СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Количество </span><span class="de_EAEC673B3E">*</span><span class="de_8A030B40E6"> СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Цена</span><span class="de_EAEC673B3E">;</span><span class="de_8A030B40E6"> </span><span class="de_EAEC673B3E">КонецПроцедуры</span></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 10px; text-indent: 0px;">&#160;</div>
</td></tr></table></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_C3917CD988">При выполнении этого кода в переменную <strong>СтрокаТабличнойЧасти </strong>помещается объект, содержащий данные текущей строки документа, которую требуется пересчитать. Получив этот объект, можно обратиться к данным конкретной колонки табличной части, указав имя колонки в качестве свойства объекта. Таким образом, во второй строке процедуры обработчика вычисляется значение колонки <strong>Сумма </strong>как произведение значений колонок <strong>Количество </strong>и <strong>Цена</strong>.</span></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_C3917CD988">Если процедура расчета суммы может понадобиться сразу для нескольких документов, то полезно разместить эту процедуру в общем модуле, и обращаться к ней из форм документов. Например, в общем модуле <strong>РаботаСДокументами </strong>поместить процедуру <strong>РассчитатьСумму()</strong>:</span></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><a href="javascript:"><span class="de_96F0909776">Копировать в буфер обмена</span></a></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 10px; text-indent: 0px;"><table class="de_tbl_566 detbl" style="width: 100%; margin-left: 0; margin-right: auto;">
<col style="width: 100%;" class="de_col_1_566" />
<tr style="height: 0px;">
<td class="de_td_566" style = "padding: 2px; padding-bottom: 1px; border-left-style: none; border-left-width: 3px; border-left-color: #0000ff; border-right-style: none; border-right-width: 3px; border-right-color: #0000ff; border-top-style: none; border-top-width: 3px; border-top-color: #0000ff; border-bottom-style: none; border-bottom-width: 3px; border-bottom-color: #0000ff;  width: 100%; vertical-align: top; background-color: #f0f0f0;" colspan = "1" rowspan = "1" >
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_EAEC673B3E">Процедура</span><span class="de_8A030B40E6"> РассчитатьСумму</span><span class="de_EAEC673B3E">(</span><span class="de_8A030B40E6">СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">)</span><span class="de_8A030B40E6"> </span><span class="de_EAEC673B3E">Экспорт</span><span class="de_8A030B40E6">&#160; &#160; СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Сумма </span><span class="de_EAEC673B3E">=</span><span class="de_8A030B40E6"> СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Количество </span><span class="de_EAEC673B3E">*</span><span class="de_8A030B40E6"> СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Цена</span><span class="de_EAEC673B3E">;</span><span class="de_8A030B40E6"> </span><span class="de_EAEC673B3E">КонецПроцедуры</span><span class="de_8A030B40E6"> </span></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 10px; text-indent: 0px;">&#160;</div>
</td></tr></table></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_C3917CD988">В модуле формы документа вызывать ее из обработчиков события <strong>ПриИзменении</strong>:</span></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><a href="javascript:"><span class="de_96F0909776">Копировать в буфер обмена</span></a></div>
<div class="p" style="text-align: left; direction: ltr; margin-left: 10px; text-indent: 0px;"><table class="de_tbl_726 detbl" style="width: 100%; margin-left: 0; margin-right: auto;">
<col style="width: 100%;" class="de_col_1_726" />
<tr style="height: 0px;">
<td class="de_td_726" style = "padding: 2px; padding-bottom: 1px; border-left-style: none; border-left-width: 3px; border-left-color: #0000ff; border-right-style: none; border-right-width: 3px; border-right-color: #0000ff; border-top-style: none; border-top-width: 3px; border-top-color: #0000ff; border-bottom-style: none; border-bottom-width: 3px; border-bottom-color: #0000ff;  width: 100%; vertical-align: top; background-color: #f0f0f0;" colspan = "1" rowspan = "1" >
<div class="p" style="text-align: left; direction: ltr; margin-left: 0px; text-indent: 0px;"><span class="de_8A030B40E6">&amp;НаКлиенте</span><span class="de_EAEC673B3E">Процедура</span><span class="de_8A030B40E6"> МатериалыКоличествоПриИзменении</span><span class="de_EAEC673B3E">(</span><span class="de_8A030B40E6">Элемент</span><span class="de_EAEC673B3E">)</span><span class="de_8A030B40E6">&#160; &#160; СтрокаТабличнойЧасти </span><span class="de_EAEC673B3E">=</span><span class="de_8A030B40E6"> Элементы</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Материалы</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">ТекущиеДанные</span><span class="de_EAEC673B3E">;</span><span class="de_8A030B40E6">&#160; &#160; РаботаСДокументами</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">РассчитатьСумму</span><span class="de_EAEC673B3E">(</span><span class="de_8A030B40E6">СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">);КонецПроцедуры</span><span class="de_8A030B40E6">&amp;НаКлиенте</span><span class="de_EAEC673B3E">Процедура</span><span class="de_8A030B40E6"> МатериалыЦенаПриИзменении</span><span class="de_EAEC673B3E">(</span><span class="de_8A030B40E6">Элемент</span><span class="de_EAEC673B3E">)</span><span class="de_8A030B40E6">&#160; &#160; СтрокаТабличнойЧасти </span><span class="de_EAEC673B3E">=</span><span class="de_8A030B40E6"> Элементы</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">Материалы</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">ТекущиеДанные</span><span class="de_EAEC673B3E">;</span><span class="de_8A030B40E6">&#160; &#160; РаботаСДокументами</span><span class="de_EAEC673B3E">.</span><span class="de_8A030B40E6">РассчитатьСумму</span><span class="de_EAEC673B3E">(</span><span class="de_8A030B40E6">СтрокаТабличнойЧасти</span><span class="de_EAEC673B3E">);КонецПроцедуры</span></div>
</td></tr></table></div>
</div>				</td>
			</tr>
		</table>
	</body>
</html>